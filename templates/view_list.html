{% extends "layout.html" %}

{% block title %}
    {{ current_list.name }}
{% endblock %}

{% block main %}
<div class="container mt-5">
    
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>{{ current_list.name }}</h1>
        
        <div class="d-flex gap-2">
            <button type="button" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#saveTemplateModal">
                Save as Template
            </button>
            
            <a href="/" class="btn btn-outline-secondary">Back to Dashboard</a>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header bg-light">
            <strong>Add New Item</strong>
        </div>
        <div class="card-body">
            <form action="{{ url_for('add_item', list_id=current_list.id) }}" method="POST" class="d-flex gap-2">
                <input type="text" name="content" class="form-control" placeholder="Enter new item..." required>
                <button type="submit" class="btn btn-success">Save Item</button>
            </form>
        </div>
    </div>

    <h3>Items</h3>
    <ul class="list-group">
        {% for item in current_list.items %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
            
            <div class="d-flex align-items-center">
                
                <form action="{{ url_for('toggle_complete') }}" method="POST" class="d-flex align-items-center me-3">
                    <input type="hidden" name="item_id" value="{{ item.id }}">
                    <input type="hidden" name="list_id" value="{{ current_list.id }}">
                    
                    <input type="checkbox" class="form-check-input" 
                           style="cursor: pointer; transform: scale(1.3);"
                           onchange="this.form.submit()" 
                           {% if item.is_completed %}checked{% endif %}>
                </form>

                <button type="button" 
                        class="badge bg-secondary rounded-pill me-3 border-0" 
                        style="cursor: pointer; min-width: 30px;"
                        data-bs-toggle="modal" 
                        data-bs-target="#quantityModal{{ item.id }}"
                        title="Click to change quantity">
                    {{ item.quantity if item.quantity else 1 }}
                </button>

                <span class="fs-5 {% if item.is_completed %}text-decoration-line-through text-muted{% endif %}">
                    {{ item.content }}
                </span>
            </div>

            <form action="/delete_item" method="POST" onsubmit="return confirm('Are you sure you would like to remove this item?');">
                <input type="hidden" name="item_id" value="{{ item.id }}">
                <input type="hidden" name="list_id" value="{{ current_list.id }}">
                <button type="submit" class="btn btn-danger btn-sm">Remove</button>
            </form>
        </li>

        <div class="modal fade" id="quantityModal{{ item.id }}" tabindex="-1" aria-hidden="true">
          <div class="modal-dialog modal-sm">
            <div class="modal-content">
              
              <div class="modal-header">
                <h5 class="modal-title">Edit Quantity</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              
              <form action="{{ url_for('update_quantity') }}" method="POST">
                  <div class="modal-body">
                    <p class="mb-2">Adjust quantity for: <strong>{{ item.content }}</strong></p>
                    
                    <input type="hidden" name="item_id" value="{{ item.id }}">
                    <input type="hidden" name="list_id" value="{{ current_list.id }}">
                    
                    <input type="number" name="new_quantity" 
                           class="form-control" 
                           value="{{ item.quantity if item.quantity else 1 }}" 
                           min="1" required>
                  </div>
                  
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary btn-sm">Update</button>
                  </div>
              </form>

            </div>
          </div>
        </div>

        {% else %}
        <li class="list-group-item text-center text-muted">No items in this list yet.</li>
        {% endfor %}
    </ul>
</div>

<div class="modal fade" id="saveTemplateModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      
      <div class="modal-header">
        <h5 class="modal-title">Create Template</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <form action="{{ url_for('save_as_template', list_id=current_list.id) }}" method="POST">
          <div class="modal-body">
            <p>Give your new template a unique name.</p>
            
            <label for="templateName" class="form-label">Template Name</label>
            <input type="text" class="form-control" id="templateName" name="template_name" 
                   value="{{ current_list.name }} (Template)" required>
          </div>
          
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary">Create Template</button>
          </div>
      </form>

    </div>
  </div>
</div>

{% endblock %}